<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registered Accounts Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply a fallback font and ensure the page is always 100% height */
        html, body {
            height: 100%;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        }
    </style>
</head>
<body class="bg-[#003366] min-h-screen flex flex-col items-center px-[10px] py-[4px]">

    <a href="https://speedofsachi.github.io/FinanceTools/Home.html#" class="absolute top-4 left-4 
        bg-gray-500 hover:bg-gray-600 text-white font-semibold 
        py-2 px-4 rounded-lg shadow-md 
        transition duration-150 ease-in-out z-10">
        Home
    </a>
    <h1 class="text-white text-center text-3xl sm:text-4xl mt-16 mb-6 md:text-6xl mt-16 mb-6 lg:text-[70px] mt-12 mb-6">
        Registered Accounts Compare
    </h1>

  <form class="w-full max-w-2xl bg-gray-100 text-gray-800 rounded-xl shadow-2xl p-8 md:p-12" onsubmit="return false;">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
        
        <div>
            <label for="account1" class="block text-sm font-medium text-gray-700 mb-1">Account 1</label>
            <select id="account1" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                <option value="RRSP" selected>RRSP</option>
                <option value="TFSA">TFSA</option>
                <option value="Margin">Margin</option>
            </select>
        </div>

        <div>
            <label for="account2" class="block text-sm font-medium text-gray-700 mb-1">Account 2</label>
            <select id="account2" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                <option value="RRSP">RRSP</option>
                <option value="TFSA" selected>TFSA</option>
                <option value="Margin">Margin</option>
            </select>
        </div>

        <div>
            <label for="balance" class="block text-sm font-medium text-gray-700 mb-1">Balance ($)</label>
            <input type="number" id="balance" step="0.01" min = "0" value="10000" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        
        <div>
            <label for="capitalReturn" class="block text-sm font-medium text-gray-700 mb-1">Capital Return (%)</label>
            <input type="number" id="capitalReturn" step="0.01" min = "0" value="6" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="divYield" class="block text-sm font-medium text-gray-700 mb-1">Dividend Yield (%)</label>
            <input type="number" id="divYield" step="0.01" value="3" min = "0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="divTaxRate" class="block text-sm font-medium text-gray-700 mb-1">Dividend Tax Rate (%)</label>
            <input type="number" id="divTaxRate" step="0.01" min = "0" value="34.47" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="taxRateStart" class="block text-sm font-medium text-gray-700 mb-1">Marginal Tax Rate Start (%)</label>
            <input type="number" id="taxRateStart" step="0.01" min = "0" value="50" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="taxRateEnd" class="block text-sm font-medium text-gray-700 mb-1">Marginal Tax Rate End (%)</label>
            <input type="number" id="taxRateEnd" step="0.01" min = "0" value="40" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div>
            <label for="timeYears" class="block text-sm font-medium text-gray-700 mb-1">Investment Horizon (years)</label>
            <input type="number" id="timeYears" step="1" min = "0" value="20" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>

        <div class="md:col-span-2 mt-4">
            <button type="button" id="calculateBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md shadow-lg transition duration-300 transform hover:scale-105">
                Calculate
            </button>
        </div>

    </div>
</form>

   <div id="result" class="mt-12 w-full max-w-4xl grid grid-cols-1 sm:grid-cols-3 gap-y-8 sm:gap-4 text-center">

        <div class="flex flex-col items-center justify-center">
            <h2 class="text-xl font-medium text-gray-300">Account 1 Balance</h2>
            <p id="account1BalanceOutput" class="text-4xl font-bold text-white mt-2">$0.00</p>
        </div>

        <div class="flex flex-col items-center justify-center">
            <h2 class="text-xl font-medium text-gray-300">Account 2 Balance</h2>
            <p id="account2BalanceOutput" class="text-4xl font-bold text-white mt-2">$0.00</p>
        </div>

        <div class="flex flex-col items-center justify-center">
            <h2 class="text-xl font-medium text-gray-300">Dfiference</h2>
            <p id="differenceOutput" class="text-4xl font-bold text-white mt-2">$0.00</p>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // Input elements
            let account1El = document.getElementById('account1'); 
            let account2El = document.getElementById('account2'); 
            let balanceEl = document.getElementById('balance'); 
            let taxRateStartEl = document.getElementById('taxRateStart'); 
            let taxRateEndEl = document.getElementById('taxRateEnd'); 
            let divTaxRateEl = document.getElementById('divTaxRate'); 
            let divYieldEl = document.getElementById('divYield'); 
            let capitalReturnEl = document.getElementById('capitalReturn'); 
            let timeYearsEl = document.getElementById('timeYears'); 
            let calculateBtn = document.getElementById('calculateBtn');
            
            // Output elements
            let account2BalanceOutputEl = document.getElementById('account2BalanceOutput');
            let account1BalanceOutputEl = document.getElementById('account1BalanceOutput');
            let differenceOutputEl = document.getElementById('differenceOutput'); // New

            // Calculate Account Balances
            function calculateAccountBalances() {
                // Get and parse all input values
                let account1 = account1El.value;
                let account2 = account2El.value;
                let balance = parseFloat(balanceEl.value) || 0; 
                let taxRateStart = (parseFloat(taxRateStartEl.value) || 0) / 100;
                let taxRateEnd = (parseFloat(taxRateEndEl.value) || 0) / 100;
                let divTaxRate = (parseFloat(divTaxRateEl.value) || 0) / 100;
                let divYield = (parseFloat(divYieldEl.value) || 0) / 100;
                let capitalReturn = (parseFloat(capitalReturnEl.value) || 0) / 100;
                let timeYears = (parseFloat(timeYearsEl.value) || 0)
                
                // Account variables
                let account1Balance = 0;
                let account2Balance = 0;
                let difference = 0;
                let differencePercent = 0;
                let differenceDisplay = "";
                let balanceTFSA = 0;
                let balanceRRSP = 0;
                let balanceMargin = 0;
                let taxRefund_t0 = 0;
                let taxRefund_t1 = 0;

                // Calculate TFSA
                balanceTFSA = balance*(1 + capitalReturn + divYield)**timeYears

                // Calculate Margin
                balanceMargin = balance*(1 + capitalReturn + divYield*(1 - divTaxRate))**timeYears
                
                // Calculate RRSP
                balanceRRSP = balance
                taxRefund_t0 = 0
                taxRefund_t1 = balanceRRSP*taxRateStart
                if (timeYears > 0) {
                   for (let i = 1; i <= timeYears; i++) {
                      balanceRRSP = balanceRRSP*(1 + capitalReturn + divYield) + taxRefund_t0
                      taxRefund_t0 = taxRefund_t1
                      taxRefund_t1 = taxRefund_t1*taxRateStart
                   }
                   balanceRRSP = balanceRRSP*(1 - taxRateEnd) + taxRefund_t0
                }
                
                // Account 1 Balance
                if (account1 == "TFSA") {
                   account1Balance = balanceTFSA
                } else if (account1 == "Margin") {
                   account1Balance = balanceMargin
                } else if (account1 == "RRSP") {
                   account1Balance = balanceRRSP
               }
               
                // Account 2 Balance
                if (account2 == "TFSA") {
                   account2Balance = balanceTFSA
                } else if (account2 == "Margin") {
                   account2Balance = balanceMargin
                } else if (account2 == "RRSP") {
                   account2Balance = balanceRRSP
               }

                // Difference
                difference = Math.abs(account1Balance - account2Balance)
                differencePercent = 100*Math.abs(difference / Math.min(account1Balance, account2Balance))
                differenceDisplay = differencePercent.toFixed(1).toLocaleString('en-US', { useGrouping: false }) + "%"
                
                // --- Display Results ---

                // 1. Account 1 Balance
                account1BalanceOutputEl.textContent = account1Balance.toLocaleString('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                 });

                // 2. Account 2 Balance
                account2BalanceOutputEl.textContent = account2Balance.toLocaleString('en-US', {
                   style: 'currency',
                   currency: 'USD',
                   minimumFractionDigits: 2,
                   maximumFractionDigits: 2
                });

                // 3. Dfiference
                differenceOutputEl.textContent = differenceDisplay.toString();

            }

            // --- Event Listeners ---
            calculateBtn.addEventListener('click', calculateAccountBalances);

        });
    </script>

</body>
</html>